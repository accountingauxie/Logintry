<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AUXILIUM Portal â€“ CV. Sukses Jaya</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://unpkg.com/feather-icons" rel="stylesheet">
<style>
/* --- 1. SYSTEM STYLE (Web UI) --- */
:root { 
    --primary-color: #116999; 
    --bg-color: #f4f7f6; 
    --text-color: #333; 
    --red-bg: #fee2e2; 
    --red-text: #991b1b;
    --border-color: #eaecf0;
}

* { box-sizing: border-box; }
body { 
    margin: 0; 
    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
    font-size: 14px; 
    background: var(--bg-color); 
    color: var(--text-color); 
    -webkit-font-smoothing: antialiased; 
}

/* --- UTILITY CLASSES --- */
.hidden { display: none !important; }

/* --- LOGIN PAGE STYLES --- */
#login-section {
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--bg-color);
}
.login-card {
    background: white;
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    width: 100%;
    max-width: 400px;
    text-align: center;
    border: 1px solid var(--border-color);
}
.login-logo img { height: 50px; margin-bottom: 20px; }
.login-title { font-size: 24px; font-weight: 700; color: #101828; margin-bottom: 8px; }
.login-subtitle { color: #667085; margin-bottom: 30px; }
.form-group { margin-bottom: 16px; text-align: left; }
.form-group label { display: block; font-weight: 500; margin-bottom: 6px; color: #344054; }
.form-input { 
    width: 100%; padding: 10px 14px; border: 1px solid #d0d5dd; border-radius: 8px; 
    font-size: 16px; outline: none; transition: border 0.2s;
}
.form-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(17, 105, 153, 0.1); }
.btn-login {
    width: 100%; padding: 12px; background-color: var(--primary-color); color: white;
    border: none; border-radius: 8px; font-weight: 600; font-size: 16px; cursor: pointer;
    transition: background 0.2s; margin-top: 10px;
}
.btn-login:hover { background-color: #0c4e75; }
.btn-login:disabled { background-color: #98a2b3; cursor: not-allowed; }
.error-msg { color: var(--red-text); background: var(--red-bg); padding: 10px; border-radius: 6px; margin-top: 15px; font-size: 13px; display: none; }

/* --- NAVIGATION BAR --- */
.aux-navbar {
    background-color: #ffffff;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 40px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    position: sticky; top: 0; z-index: 1000;
}

/* Logo Setup */
.aux-logo { display: flex; align-items: center; gap: 10px; }
.aux-logo img { height: 45px; width: auto; object-fit: contain; }

/* Menu Wrapper */
.aux-menu { 
    display: flex; 
    gap: 8px; 
    align-items: center; 
    height: 100%; 
}

/* Navigation Item Wrapper */
.nav-item {
    position: relative;
    height: 100%;
    display: flex;
    align-items: center;
}

/* Main Link Style */
.aux-link { 
    text-decoration: none; 
    color: #475467; 
    font-weight: 600; 
    font-size: 14px; 
    padding: 8px 16px; 
    border-radius: 6px; 
    transition: all 0.2s; 
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
}

.aux-link:hover, .nav-item:hover .aux-link { 
    background-color: #f2f4f7; 
    color: #101828;
}

.aux-link.active { 
    background-color: #eff8ff; 
    color: var(--primary-color); 
    font-weight: 700; 
}

.chevron-down { width: 14px; height: 14px; transition: transform 0.2s; }
.nav-item:hover .chevron-down { transform: rotate(180deg); }

/* --- DROPDOWN MENU --- */
.dropdown-menu {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    top: 85%; 
    left: 0;
    background: white;
    min-width: 240px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    padding: 8px;
    z-index: 9999;
    transform: translateY(10px);
    transition: all 0.2s ease-in-out;
}

.dropdown-menu::before {
    content: "";
    position: absolute;
    top: -20px; left: 0; width: 100%; height: 20px; background: transparent;
}

.nav-item:hover .dropdown-menu {
    visibility: visible;
    opacity: 1;
    transform: translateY(0);
}

.dropdown-item {
    display: flex;
    align-items: center;
    padding: 10px 12px;
    color: #344054;
    text-decoration: none;
    font-size: 14px;
    border-radius: 6px;
    transition: background 0.2s;
}

.dropdown-item:hover {
    background-color: #f9fafb;
    color: var(--primary-color);
}

.dropdown-divider { height: 1px; background-color: #eaecf0; margin: 6px 0; }

.dropdown-header {
    font-size: 11px;
    text-transform: uppercase;
    color: #98a2b3;
    font-weight: 600;
    padding: 8px 12px 4px;
    letter-spacing: 0.5px;
}

/* --- USER PANEL --- */
.user-panel { 
    display: flex; align-items: center; gap: 12px; 
    padding-left: 20px; border-left: 1px solid var(--border-color); 
}
.user-details { display: flex; flex-direction: column; text-align: right; line-height: 1.3; }
.user-name { font-weight: 700; font-size: 13px; color: #101828; }
.user-role { font-size: 11px; color: #667085; }
.user-avatar { 
    width: 36px; height: 36px; 
    background-color: var(--primary-color); 
    color: white; 
    border-radius: 50%; 
    display: flex; align-items: center; justify-content: center; 
    font-weight: 600; font-size: 14px; user-select: none; 
}
.logout-btn { 
    background: none; border: 1px solid var(--border-color); color: #666; 
    width: 36px; height: 36px; border-radius: 8px; 
    cursor: pointer; display: flex; align-items: center; justify-content: center; 
    transition: all 0.2s; 
}
.logout-btn:hover { background-color: var(--red-bg); color: var(--red-text); border-color: var(--red-bg); }

/* --- CONTENT GRID --- */
.main-container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 40px; }
.content h2 { margin-top: 0; font-size: 28px; font-weight: 700; color: #101828; }
.subtitle { font-size: 16px; color: #667085; margin-top: 8px; margin-bottom: 40px; }

.grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; }
@media (max-width: 1100px) { .grid { grid-template-columns: repeat(2, 1fr); } }

.tile {
    background: white; padding: 24px; border-radius: 12px;
    box-shadow: 0px 1px 3px rgba(16, 24, 40, 0.1), 0px 1px 2px rgba(16, 24, 40, 0.06);
    cursor: pointer; transition: all 0.2s ease;
    min-height: 220px; display: flex; flex-direction: column; justify-content: space-between;
    border: 1px solid var(--border-color); text-decoration: none;
}
.tile:hover { transform: translateY(-4px); box-shadow: 0px 12px 16px -4px rgba(16, 24, 40, 0.08); border-color: #d0d5dd; }
.tile-icon { margin-bottom: 20px; color: #475467; }
.tile-title { font-size: 18px; font-weight: 700; color: #101828; margin-bottom: 8px; }
.tile-desc { font-size: 14px; color: #667085; line-height: 1.5; }

/* --- MODAL & LOADER --- */
.modal { display: none; position: fixed; z-index: 10001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
.modal-content { background-color: #fff; margin: 15% auto; padding: 32px; border-radius: 16px; width: 360px; text-align: center; }
.modal-buttons { display: flex; justify-content: center; gap: 12px; margin-top: 24px; }
.btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; flex: 1; }
.btn-yes { background-color: #d92d20; color: #fff; }
.btn-cancel { background-color: #f2f4f7; color: #344054; }

.auxie-loader { position: fixed; inset: 0; background: #ffffff; display: flex; justify-content: center; align-items: center; z-index: 99999; transition: opacity 0.5s ease; }
.auxie-loader.hide { opacity: 0; pointer-events: none; }
.spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>

<body>
  <div id="auxieLoading" class="auxie-loader">
    <div class="spinner"></div>
  </div>

  <div id="login-section">
      <div class="login-card">
          <div class="login-logo">
              <img src="https://raw.githubusercontent.com/accountingauxie/Auxilium-Portal-Sukses-Jaya/refs/heads/main/assets/auxilium_logo_pure_white_bg.png" alt="Auxilium Logo">
          </div>
          <h1 class="login-title">Log in</h1>
          <p class="login-subtitle">Masukkan kredensial Anda untuk mengakses portal.</p>
          
          <form onsubmit="event.preventDefault(); handleLogin();">
              <div class="form-group">
                  <label for="email">Email</label>
                  <input type="email" id="email" class="form-input" placeholder="nama@cvsuksesjaya.com" required>
              </div>
              <div class="form-group">
                  <label for="password">Password</label>
                  <input type="password" id="password" class="form-input" placeholder="Masukkan password" required>
              </div>
              <div id="login-error" class="error-msg"></div>
              <button type="submit" id="login-btn" class="btn-login">Masuk</button>
          </form>
      </div>
  </div>

  <div id="dashboard-section" class="hidden">
      <div class="aux-navbar">
        <div class="aux-logo">
            <img src="https://raw.githubusercontent.com/accountingauxie/Auxilium-Portal-Sukses-Jaya/refs/heads/main/assets/auxilium_logo_pure_white_bg.png" alt="Auxilium Logo">
        </div>
        
        <nav class="aux-menu">
            <div class="nav-item">
                <a href="#" class="aux-link active">Home</a>
            </div>

            <div class="nav-item" id="nav-group-penjualan">
                <div class="aux-link">
                    Penjualan 
                    <i data-feather="chevron-down" class="chevron-down"></i>
                </div>
                <div class="dropdown-menu">
                    <div class="dropdown-header">Sales Orders</div>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/Penjualan/Order%20Penjualan/index.html" class="dropdown-item" id="access-orderPenjualan">Order Penjualan</a>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/Penjualan/Review%20Penjualan/review_penjualan.html" class="dropdown-item" id="access-reviewPenjualan">Review Penjualan</a>
                </div>
            </div>

            <div class="nav-item" id="nav-group-pembelian">
                <div class="aux-link">
                    Pembelian
                    <i data-feather="chevron-down" class="chevron-down"></i>
                </div>
                <div class="dropdown-menu">
                    <div class="dropdown-header">Purchasing</div>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/receiving/PurchaseOrder/index.html" class="dropdown-item" id="access-pemesananBarang">Pemesanan Pembelian</a>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/receiving/entry/index.html" class="dropdown-item" id="access-penerimaanBarang">Penerimaan Barang (Entry)</a>
                    
                    <div class="dropdown-divider"></div>
                    
                    <div class="dropdown-header">Finance</div>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/receiving/CreateBill/index.html" class="dropdown-item" id="access-daftarTagihan">Daftar Tagihan (Bill)</a>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/receiving/ImportXeroPO/index.html" class="dropdown-item" id="access-importXero">Import Xero PO</a>
                </div>
            </div>

            <div class="nav-item" id="nav-group-produksi">
                <div class="aux-link">
                    Produksi
                    <i data-feather="chevron-down" class="chevron-down"></i>
                </div>
                <div class="dropdown-menu">
                    <div class="dropdown-header">Input Mesin</div>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/Produksi/Produksi%20-%20Back%20Order/produksi_backorder.html" class="dropdown-item" id="access-backOrder">Back Order</a>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/Produksi/Produksi%20-%20General%20Order/produksi_general.html" class="dropdown-item" id="access-generalOrder">General Order</a>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/Produksi/Produksi%20-%20Pre%20Order/produksi_preorder.html" class="dropdown-item" id="access-preOrder">Pre Order</a>

                    <div class="dropdown-divider"></div>
                    
                    <div class="dropdown-header">Hasil Produksi</div>
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/production/daftarproduksi/index.html" class="dropdown-item" id="access-produksiBarang">Produksi Barang Jadi</a>
                </div>
            </div>

            <div class="nav-item" id="nav-group-persediaan">
                <div class="aux-link">
                    Persediaan
                    <i data-feather="chevron-down" class="chevron-down"></i>
                </div>
                <div class="dropdown-menu">
                    <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/inventory/index.html" class="dropdown-item" id="access-cekStok">Cek Stok Inventory</a>
                </div>
            </div>
        </nav>

        <div class="user-panel">
            <div class="user-details">
                <span class="user-name" id="display-nama">Loading...</span>
                <span class="user-role" id="display-role">...</span>
            </div>
            <div class="user-avatar" id="display-initial">AX</div>
            <button class="logout-btn" onclick="showLogoutModal()" title="Keluar Akun">
                <i data-feather="log-out" style="width:16px; height:16px;"></i>
            </button>
        </div>
      </div>

      <div class="main-container">
        <div class="content">
          <h2>Welcome Back, <span id="display-nama-sapaan">User</span> ðŸ‘‹</h2>
          <p class="subtitle">Silakan pilih modul melalui menu navigasi di atas atau kartu akses cepat di bawah ini.</p>
          
          <div class="grid">
            <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/receiving/entry/index.html" class="tile" id="tile-penerimaanBarang">
              <div>
                <div class="tile-icon"><i data-feather="truck" style="width:32px; height:32px;"></i></div>
                <div class="tile-title">Penerimaan (Receiving)</div>
                <div class="tile-desc">Input penerimaan barang material dan purchase order masuk.</div>
              </div>
            </a>

            <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/production/daftarproduksi/index.html" class="tile" id="tile-produksiBarang">
              <div>
                  <div class="tile-icon"><i data-feather="package" style="width:32px; height:32px;"></i></div>
                  <div class="tile-title">Produksi (Finished Goods)</div>
                  <div class="tile-desc">Lihat dan kelola daftar barang jadi hasil produksi.</div>
              </div>
            </a>

            <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/Penjualan/Order%20Penjualan/index.html" class="tile" id="tile-orderPenjualan">
              <div>
                  <div class="tile-icon"><i data-feather="shopping-cart" style="width:32px; height:32px;"></i></div>
                  <div class="tile-title">Penjualan (Sales)</div>
                  <div class="tile-desc">Buat order penjualan baru untuk pelanggan.</div>
              </div>
            </a>

            <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/inventory/index.html" class="tile" id="tile-cekStok">
              <div>
                  <div class="tile-icon"><i data-feather="layers" style="width:32px; height:32px;"></i></div>
                  <div class="tile-title">Inventory</div>
                  <div class="tile-desc">Monitoring stok gudang, Spandek, KPC, dan lainnya.</div>
              </div>
            </a>
          </div> 
        </div>
      </div>
  </div>

  <div id="logoutModal" class="modal">
    <div class="modal-content">
      <div style="background:#fee2e2; width:48px; height:48px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 16px;">
        <i data-feather="alert-circle" style="color:#d92d20;"></i>
      </div>
      <p style="font-size:18px; font-weight:600; color:#101828; margin-bottom:10px; margin-top:0;">Konfirmasi Keluar</p>
      <p style="color:#667085; font-size:14px; margin-bottom:24px;">Apakah Anda yakin ingin keluar dari sistem?</p>
      <div class="modal-buttons">
        <button class="btn btn-cancel" onclick="closeLogoutModal()">Batal</button>
        <button class="btn btn-yes" onclick="performLogout()">Keluar</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/feather-icons"></script>
  <script>
    // --- KONFIGURASI PENTING ---
    // GANTI URL INI DENGAN URL APPS SCRIPT YANG KAMU BUAT DI LANGKAH SEBELUMNYA
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyInz6Qqip0xfaw-0XVS7vDixu5RLdjGbEIhqrCfTuw-J07kyT9WCM1uUtrSyEBn89o/exec"; 

    // --- MAIN LOGIC ---
    feather.replace();

    // 1. Cek sesi saat halaman dimuat
    window.onload = function() {
        const loader = document.getElementById("auxieLoading");
        const savedUser = localStorage.getItem('userSession');

        if (savedUser) {
            // Jika sudah login, langsung tampilkan dashboard
            const user = JSON.parse(savedUser);
            initDashboard(user);
            setTimeout(() => loader.classList.add("hide"), 500);
        } else {
            // Jika belum login, tampilkan form login
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('dashboard-section').classList.add('hidden');
            setTimeout(() => loader.classList.add("hide"), 500);
        }
    };

    // 2. Fungsi Login
    function handleLogin() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const btn = document.getElementById('login-btn');
        const errorMsg = document.getElementById('login-error');

        // Reset UI
        btn.disabled = true;
        btn.innerText = "Memproses...";
        errorMsg.style.display = 'none';

        fetch(SCRIPT_URL, {
            method: "POST",
            body: JSON.stringify({ email: email, password: password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                // Simpan data user
                localStorage.setItem('userSession', JSON.stringify(data.user));
                // Pindah ke dashboard
                initDashboard(data.user);
            } else {
                errorMsg.innerText = data.message;
                errorMsg.style.display = 'block';
                btn.disabled = false;
                btn.innerText = "Masuk";
            }
        })
        .catch(error => {
            console.error('Error:', error);
            errorMsg.innerText = "Gagal terhubung ke server. Coba lagi.";
            errorMsg.style.display = 'block';
            btn.disabled = false;
            btn.innerText = "Masuk";
        });
    }

    // 3. Inisialisasi Dashboard & Hak Akses
    function initDashboard(user) {
        // Hide Login, Show Dashboard
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('dashboard-section').classList.remove('hidden');

        // Isi Data User
        document.getElementById('display-nama').innerText = user.nama;
        document.getElementById('display-nama-sapaan').innerText = user.nama.split(" ")[0]; // Ambil nama depan
        document.getElementById('display-role').innerText = user.role;
        
        // Buat Inisial (Contoh: Ericko Kevin -> EK)
        const initials = user.nama.split(" ").map((n)=>n[0]).join("").substring(0,2).toUpperCase();
        document.getElementById('display-initial').innerText = initials;

        // --- TERAPKAN HAK AKSES (Logic Inti) ---
        const rights = user.akses;

        // Fungsi helper untuk menyembunyikan elemen jika akses FALSE
        // Kita cek id di Navbar (access-...) dan id di Tile (tile-...)
        applyPermission('access-orderPenjualan', rights.orderPenjualan);
        applyPermission('tile-orderPenjualan', rights.orderPenjualan); // Tile di grid

        applyPermission('access-reviewPenjualan', rights.reviewPenjualan);
        
        applyPermission('access-pemesananBarang', rights.pemesananBarang);
        
        applyPermission('access-penerimaanBarang', rights.penerimaanBarang);
        applyPermission('tile-penerimaanBarang', rights.penerimaanBarang); // Tile di grid

        applyPermission('access-daftarKelolaPO', rights.daftarKelolaPO);
        applyPermission('access-daftarTagihan', rights.daftarTagihan);
        applyPermission('access-importXero', rights.importXero);
        
        applyPermission('access-backOrder', rights.backOrder);
        applyPermission('access-generalOrder', rights.generalOrder);
        applyPermission('access-preOrder', rights.preOrder);
        
        applyPermission('access-produksiBarang', rights.produksiBarang);
        applyPermission('tile-produksiBarang', rights.produksiBarang); // Tile di grid
        
        applyPermission('access-cekStok', rights.cekStok);
        applyPermission('tile-cekStok', rights.cekStok); // Tile di grid

        // Refresh icons karena elemen mungkin berubah
        feather.replace();
    }

    function applyPermission(elementId, isAllowed) {
        const el = document.getElementById(elementId);
        if (!el) return; // Jika elemen tidak ada di HTML, skip

        // Cek apakah TRUE, "TRUE", atau "true"
        const allowed = (isAllowed === true || isAllowed === "TRUE" || isAllowed === "true");
        
        if (!allowed) {
            el.style.display = 'none'; // Sembunyikan jika tidak punya akses
        } else {
            el.style.display = ''; // Tampilkan (reset)
        }
    }

    // 4. Modal Logic
    function showLogoutModal() { document.getElementById("logoutModal").style.display = "block"; }
    function closeLogoutModal() { document.getElementById("logoutModal").style.display = "none"; }
    
    function performLogout() {
        localStorage.removeItem('userSession');
        location.reload(); // Refresh halaman untuk kembali ke login
    }

    // Klik di luar modal untuk menutup
    window.onclick = function(event) {
        if (event.target == document.getElementById("logoutModal")) {
            closeLogoutModal();
        }
    }
  </script>
</body>
</html>
